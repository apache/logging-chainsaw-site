<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from org.apache.maven.plugins:maven-pmd-plugin:3.15.0:cpd at 2022-03-04
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>Apache Chainsaw &#x2013; CPD Results</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="http://logging.apache.org/" id="bannerLeft"><img src="images/ls-logo.jpg"  alt="Logging Services"/></a></div>
          <div class="pull-right"><a href="../log4j/2.x/" id="bannerRight"><img src="images/logo.png"  alt="Apache log4j"/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-03-04<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.2.0-SNAPSHOT<span class="divider">|</span></li>
      <li class=""><a href="http://www.apache.org/" class="externalLink" title="Apache">Apache</a><span class="divider">/</span></li>
      <li class=""><a href="http://logging.apache.org/" class="externalLink" title="Logging Services">Logging Services</a><span class="divider">/</span></li>
      <li class=""><a href="http://logging.apache.org:80/chainsaw/" class="externalLink" title="Chainsaw">Chainsaw</a><span class="divider">/</span></li>
    <li class="active ">CPD Results</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Get Chainsaw</li>
    <li><a href="download.html" title="Download"><span class="none"></span>Download</a></li>
    <li><a href="changes-report.html" title="Changes"><span class="none"></span>Changes</a></li>
    <li><a href="https://www.apache.org/licenses/LICENSE-2.0" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="distributionnotes.html" title="Important Distribution Notes"><span class="none"></span>Important Distribution Notes</a></li>
   <li class="nav-header">About Chainsaw</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="quicktour.html" title="Quick Tour"><span class="none"></span>Quick Tour</a></li>
    <li><a href="zeroconf.html" title="Zeroconf"><span class="none"></span>Zeroconf</a></li>
    <li><a href="roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="apidocs/index.html" title="JavaDoc"><span class="none"></span>JavaDoc</a></li>
   <li class="nav-header">Manual</li>
    <li><a href="configuration-library.html" title="Configuration Library"><span class="none"></span>Configuration Library</a></li>
   <li class="nav-header">Community</li>
    <li><a href="mail-lists.html" title="Mailing Lists"><span class="none"></span>Mailing Lists</a></li>
    <li><a href="issue-tracking.html" title="Issue Tracking"><span class="none"></span>Issue Tracking</a></li>
   <li class="nav-header">Development</li>
    <li><a href="source-repository.html" title="Repository"><span class="none"></span>Repository</a></li>
    <li><a href="xref/index.html" title="Cross Reference"><span class="none"></span>Cross Reference</a></li>
    <li><a href="dependencies.html" title="Dependencies"><span class="none"></span>Dependencies</a></li>
    <li class="active"><a href="#"><span class="none"></span>Duplication</a></li>
    <li><a href="pmd.html" title="PMD"><span class="none"></span>PMD</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="http://www.apache.org" class="externalLink" title="Home"><span class="none"></span>Home</a></li>
    <li><a href="http://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="http://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="http://www.apachecon.com" class="externalLink" title="Conferences"><span class="none"></span>Conferences</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<section>
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">CPD</a> 6.38.0.</p></section><section>
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/xml/UtilLoggingXMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/UtilLoggingXMLDecoder.html#L160">160</a></td></tr>
<tr class="a">
<td>org/apache/log4j/xml/XMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/XMLDecoder.html#L164">164</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>new InputSource(new StringReader(buf.toString()));
            document = docBuilder.parse(inputSource);
        } catch (Exception e) {
            e.printStackTrace();
        }

        return document;
    }

    /**
     * Decodes a File into a Vector of LoggingEvents.
     *
     * @param url the url of a file containing events to decode
     * @return Vector of LoggingEvents
     * @throws IOException if IO error during processing.
     */
    public Vector&lt;ChainsawLoggingEvent&gt; decode(final URL url) throws IOException {
        LineNumberReader reader;
        boolean isZipFile = url.getPath().toLowerCase().endsWith(&quot;.zip&quot;);
        InputStream inputStream;
        if (isZipFile) {
            inputStream = new ZipInputStream(url.openStream());
            //move stream to next entry so we can read it
            ((ZipInputStream) inputStream).getNextEntry();
        } else {
            inputStream = url.openStream();
        }
        if (owner != null) {
            reader = new LineNumberReader(
                new InputStreamReader(
                    new ProgressMonitorInputStream(owner,
                        &quot;Loading &quot; + url, inputStream), ENCODING));
        } else {
            reader = new LineNumberReader(new InputStreamReader(inputStream, ENCODING));
        }
        Vector&lt;ChainsawLoggingEvent&gt; v = new Vector&lt;&gt;();

        String line;
        Vector&lt;ChainsawLoggingEvent&gt; events;
        try {
            while ((line = reader.readLine()) != null) {
                StringBuilder buffer = new StringBuilder(line);
                for (int i = 0; i &lt; 1000; i++) {
                    buffer.append(reader.readLine()).append(&quot;\n&quot;);
                }
                events = decodeEvents(buffer.toString());
                if (events != null) {
                    v.addAll(events);
                }
            }
        } finally {
            partialEvent = null;
            try {
                if (reader != null) {
                    reader.close();
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        return v;
    }

    /**
     * Decodes a String representing a number of events into a
     * Vector of LoggingEvents.
     *
     * @param document to decode events from
     * @return Vector of LoggingEvents
     */
    public Vector&lt;ChainsawLoggingEvent&gt; decodeEvents(final String document) {

        if (document != null) {

            if (document.trim().equals(&quot;&quot;)) {
                return null;
            }

            String newDoc;
            String newPartialEvent = null;
            //separate the string into the last portion ending with &lt;/record&gt;
            // (which will be processed) and the partial event which
            // will be combined and processed in the next section

            //if the document does not contain a record end,
            // append it to the partial event string
            if (document.lastIndexOf(RECORD_END) == -1) {
                partialEvent = partialEvent + document;
                return null;
            }

            if (document.lastIndexOf(RECORD_END) + RECORD_END.length()
                &lt; document.length()) {
                newDoc = document.substring(0,
                    document.lastIndexOf(RECORD_END) + RECORD_END.length());
                newPartialEvent = document.substring(
                    document.lastIndexOf(RECORD_END) + RECORD_END.length());
            } else {
                newDoc = document;
            }
            if (partialEvent != null) {
                newDoc = partialEvent + newDoc;
            }
            partialEvent = newPartialEvent;

            Document doc = parse(newDoc);
            if (doc == null) {
                return null;
            }
            return decodeEvents(doc);
        }
        return null;
    }

    /**
     * Converts the string data into an XML Document, and then soaks out the
     * relevant bits to form a new LoggingEvent instance which can be used
     * by any Log4j element locally.
     *
     * @param data XML fragment
     * @return a single LoggingEvent or null
     */
    public ChainsawLoggingEvent decode(final String data) {
        Document document = parse(data);

        if (document == null) {
            return null;
        }

        Vector&lt;ChainsawLoggingEvent&gt; events = decodeEvents(document);

        if (events.size() &gt; 0) {
            return events.firstElement();
        }

        return null;
    }

    /**
     * Given a Document, converts the XML into a Vector of LoggingEvents.
     *
     * @param document XML document
     * @return Vector of LoggingEvents
     */
    private Vector&lt;ChainsawLoggingEvent&gt; decodeEvents(final Document document) {
        Vector&lt;ChainsawLoggingEvent&gt; events = new Vector&lt;&gt;();</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/rule/AndRule.java</td>
<td><a href="./xref/org/apache/log4j/rule/AndRule.html#L100">100</a></td></tr>
<tr class="a">
<td>org/apache/log4j/rule/OrRule.java</td>
<td><a href="./xref/org/apache/log4j/rule/OrRule.html#L100">100</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (result) {
            for (Iterator iter = tempMatches1.entrySet().iterator();iter.hasNext();) {
                Map.Entry entry = (Map.Entry)iter.next();
                Object key = entry.getKey();
                Set value = (Set)entry.getValue();
                Set mainSet = (Set) matches.get(key);
                if (mainSet == null) {
                    mainSet = new HashSet();
                    matches.put(key, mainSet);
                }
                mainSet.addAll(value);
            }
            for (Iterator iter = tempMatches2.entrySet().iterator();iter.hasNext();) {
                Map.Entry entry = (Map.Entry)iter.next();
                Object key = entry.getKey();
                Set value = (Set)entry.getValue();
                Set mainSet = (Set) matches.get(key);
                if (mainSet == null) {
                    mainSet = new HashSet();
                    matches.put(key, mainSet);
                }
                mainSet.addAll(value);
            }
        }
        return result;
  }
}</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/rule/LevelEqualsRule.java</td>
<td><a href="./xref/org/apache/log4j/rule/LevelEqualsRule.html#L60">60</a></td></tr>
<tr class="a">
<td>org/apache/log4j/rule/NotLevelEqualsRule.java</td>
<td><a href="./xref/org/apache/log4j/rule/NotLevelEqualsRule.html#L60">60</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>private LevelEqualsRule(final Level level) {
        super();
        this.level = level;
    }

    /**
     * Populate list of levels.
     */
    private static void populateLevels() {
        levelList = new LinkedList();

        levelList.add(Level.FATAL.toString());
        levelList.add(Level.ERROR.toString());
        levelList.add(Level.WARN.toString());
        levelList.add(Level.INFO.toString());
        levelList.add(Level.DEBUG.toString());
        levelList.add(Level.TRACE.toString());
    }

    /**
     * Create new rule.
     * @param value name of level.
     * @return instance of LevelEqualsRule.
     */
    public static Rule getRule(final String value) {
        Level thisLevel = null;
        if (levelList.contains(value.toUpperCase())) {
            thisLevel = Level.valueOf(value.toUpperCase());
        } else {
//            thisLevel = UtilLoggingLevel.toLevel(value.toUpperCase());
        }

        return new LevelEqualsRule(thisLevel);</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/chainsaw/icons/LineIconFactory.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/icons/LineIconFactory.html#L44">44</a></td></tr>
<tr class="a">
<td>org/apache/log4j/chainsaw/icons/LineIconFactory.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/icons/LineIconFactory.html#L77">77</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public static Icon createExpandIcon() {
        int size = 8;
        int xOffSet = 0;
        int yOffSet = 0;
        try {
            GraphicsEnvironment environment =
                GraphicsEnvironment.getLocalGraphicsEnvironment();
            BufferedImage image = new BufferedImage(size, size, BufferedImage.TYPE_INT_ARGB);
            Graphics2D g2D =
                environment.createGraphics(
                    image);
            g2D.setBackground(new Color(0, 0, 0, 0));
            g2D.clearRect(0, 0, size, size);
            g2D.setStroke(new BasicStroke(1.5f));
            g2D.setRenderingHint(
                RenderingHints.KEY_STROKE_CONTROL, RenderingHints.VALUE_STROKE_PURE);
            g2D.setColor(Color.black);
            g2D.drawLine(
                xOffSet, (size / 2) + yOffSet, size - xOffSet,
                (size / 2) + yOffSet);</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/xml/UtilLoggingXMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/UtilLoggingXMLDecoder.html#L410">410</a></td></tr>
<tr class="a">
<td>org/apache/log4j/xml/XMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/XMLDecoder.html#L428">428</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
            }

            LocationInfo info;
            if ((fileName != null)
                || (className != null)
                || (methodName != null)
                || (lineNumber != null)) {
                info = new LocationInfo(fileName, className, methodName, 
                        Integer.parseInt(lineNumber));
            } else {
                info = null;
            }

//            ThrowableInformation throwableInfo = null;
//            if (exception != null) {
//                throwableInfo = new ThrowableInformation(exception);
//            }

            builder.clear();
            builder.setLogger(logger)
                    .setTimestamp(Instant.ofEpochMilli(timeStamp))
                    .setLevelFromString(level)
                    .setMessage(message)
                    .setThreadName(threadName)
                    .setMDC(properties)
                    .setNDC(ndc)
                    .setLocationInfo(info);


            events.add(builder.create());</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/xml/XMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/XMLDecoder.html#L359">359</a></td></tr>
<tr class="a">
<td>org/apache/log4j/xml/XMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/XMLDecoder.html#L399">399</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>NodeList propertyList = list.item(y).getChildNodes();
                    int propertyLength = propertyList.getLength();

                    for (int i = 0; i &lt; propertyLength; i++) {
                        String propertyTag = propertyList.item(i).getNodeName();

                        if (propertyTag.equalsIgnoreCase(&quot;log4j:data&quot;)) {
                            Node property = propertyList.item(i);
                            String name =
                                property.getAttributes().getNamedItem(&quot;name&quot;).getNodeValue();
                            String value =
                                property.getAttributes().getNamedItem(&quot;value&quot;).getNodeValue();
                            properties.put(name, value);
                        }
                    }
                }

                if (tagName.equalsIgnoreCase(&quot;log4j:throwable&quot;)) {</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/chainsaw/LogPanel.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/LogPanel.html#L3866">3866</a></td></tr>
<tr class="a">
<td>org/apache/log4j/chainsaw/LogPanel.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/LogPanel.html#L3886">3886</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>} else if (e.getType() == TableModelEvent.DELETE) {
                    //find each eventwrapper with an id in the deleted range and remove it...
//                        System.out.println(&quot;delete- current warnings: &quot; + warnings.size() + &quot;, errors: &quot; + errors.size() + &quot;, first row: &quot; + firstRow + &quot;, last row: &quot; + lastRow + &quot;, displayed event count: &quot; + displayedEvents.size() );
                    for (Iterator&lt;ThumbnailLoggingEventWrapper&gt; iter = secondaryList.iterator(); iter.hasNext(); ) {
                        ThumbnailLoggingEventWrapper wrapper = iter.next();
                        if ((wrapper.rowNum &gt;= firstRow) &amp;&amp; (wrapper.rowNum &lt;= lastRow)) {
//                                System.out.println(&quot;deleting find: &quot; + wrapper);
                            iter.remove();
                        }
                    }
                    for (Iterator&lt;ThumbnailLoggingEventWrapper&gt; iter = primaryList.iterator(); iter.hasNext(); ) {
                        ThumbnailLoggingEventWrapper wrapper = iter.next();
                        if ((wrapper.rowNum &gt;= firstRow) &amp;&amp; (wrapper.rowNum &lt;= lastRow)) {
//                                System.out.println(&quot;deleting error: &quot; + wrapper);
                            iter.remove();
                        }
                    }</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/chainsaw/LogPanel.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/LogPanel.html#L3643">3643</a></td></tr>
<tr class="a">
<td>org/apache/log4j/chainsaw/LogPanel.java</td>
<td><a href="./xref/org/apache/log4j/chainsaw/LogPanel.html#L3719">3719</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>i++;
                //only add if there is a color defined
                if (primaryMatches(wrapper)) {
                    primaryList.add(wrapper);
                }
            }
            revalidate();
            repaint();
        }

        public void paintComponent(Graphics g) {
            super.paintComponent(g);

            int rowCount = table.getRowCount();
            if (rowCount == 0) {
                return;
            }
            //use event pane height as reference height - max component height will be extended by event height if
            // last row is rendered, so subtract here
            int height = eventsPane.getHeight();
            int maxHeight = Math.min(maxEventHeight, (height / rowCount));
            int minHeight = Math.max(1, maxHeight);
            int componentHeight = height - minHeight;
            int eventHeight = minHeight;

            //draw all events
            for (Object aPrimaryList : primaryList) {</pre></div></td></tr></table>
<table border="0" class="table table-striped">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/apache/log4j/xml/UtilLoggingXMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/UtilLoggingXMLDecoder.html#L442">442</a></td></tr>
<tr class="a">
<td>org/apache/log4j/xml/XMLDecoder.java</td>
<td><a href="./xref/org/apache/log4j/xml/XMLDecoder.html#L467">467</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
        return events;
    }

    /**
     * Get contents of CDATASection.
     *
     * @param n CDATASection
     * @return text content of all text or CDATA children of node.
     */
    private String getCData(final Node n) {
        StringBuilder buf = new StringBuilder();
        NodeList nl = n.getChildNodes();

        for (int x = 0; x &lt; nl.getLength(); x++) {
            Node innerNode = nl.item(x);

            if (
                (innerNode.getNodeType() == Node.TEXT_NODE)
                    || (innerNode.getNodeType() == Node.CDATA_SECTION_NODE)) {
                buf.append(innerNode.getNodeValue());
            }
        }

        return buf.toString();
    }
}</pre></div></td></tr></table></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2002&#x2013;2022<a href="https://www.apache.org/">The Apache Software Foundation</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
